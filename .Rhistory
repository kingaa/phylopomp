fortify(ladderize=TRUE)
read.tree(text=tr) %>%
fortify(ladderize=TRUE) %>%
arrange(x) %>%
}
tr <- gsub("i:0.0,","",y$tree)
read.tree(text=tr) %>%
fortify(ladderize=TRUE) %>%
arrange(x)
read.tree(text=tr) %>%
fortify(ladderize=TRUE) %>%
arrange(x) %>%
select(x,y,isTip)
read.tree(text=tr) %>% plot
read.tree(text=tr) %>%
fortify(ladderize=TRUE) %>%
arrange(x) %>%
select(x,y,isTip) %>%
mutate(dd=c(0,as.numeric(diff(y)==0)))
read.tree(text=tr) %>%
fortify(ladderize=TRUE) %>%
arrange(x) %>%
select(x,y,isTip) %>%
mutate(dd=c(diff(y),NA))
read.tree(text=tr) %>%
fortify(ladderize=TRUE) %>%
arrange(x) %>%
select(x,y,isTip) %>%
mutate(dd=c(as.numeric(diff(y)==0),NA))
read.tree(text=tr) %>%
fortify(ladderize=TRUE) %>%
arrange(x)
tr
gsub("\\d+:",":",tr)
gsub("i|g","",gsub("\\d+:",":",tr))
text <- gsub("i|g","",gsub("\\d+:",":",tr))
read.tree(text=text) %>%
fortify(ladderize=TRUE) %>%
arrange(x)
read.tree(text=text) %>%
fortify(ladderize=TRUE) %>%
arrange(x) %>%
select(x,y,isTip) %>%
mutate(sample=as.numeric(isTip))
read.tree(text=text) %>%
fortify(ladderize=TRUE) %>%
arrange(x) %>%
mutate(sample=as.numeric(isTip))
read.tree(text=text) %>%
fortify(ladderize=TRUE) %>%
select(parent,node,isTip,x) %>%
arrange(x) %>%
mutate(sample=as.numeric(isTip))
read.tree(text=text) %>%
fortify(ladderize=TRUE) %>%
select(parent,node,isTip,x) %>%
filter(x>0.00) %>%
arrange(x)
read.tree(text=text) %>%
fortify(ladderize=TRUE) ->tt
match(tt$node,tt$parent)
table(match(tt$node,tt$parent))
read.tree(text=text) %>%
fortify(ladderize=TRUE) %>%
select(parent,node,isTip,x) %>%
filter(x>0.00) %>%
arrange(x) -> tt
table(match(tt$node,tt$parent))
match(tt$node,tt$parent)
intersect(tt$node,tt$parent)
table(intersect(tt$node,tt$parent))
tt
setdiff(tt$parent,tt$node)
table(tt$parent)
table(tt$parent)[as.character(tt$node)]
read.tree(text=text) %>%
fortify(ladderize=TRUE) %>%
select(parent,node,isTip,x) %>%
filter(x>0.00) %>%
arrange(x) %>%
mutate(sample=as.numeric(isTip),
dd=table(parent)[as.character(node)])
read.tree(text=text) %>%
fortify(ladderize=TRUE) %>%
select(parent,node,isTip,x) %>%
filter(x>0.00) %>%
arrange(x) %>%
mutate(sample=as.numeric(isTip),
inter=table(parent)[as.character(node)],
dd=as.numeric(inter==1),
coal=as.numeric(inter==2))
read.tree(text=text) %>%
fortify(ladderize=TRUE) %>%
select(parent,node,isTip,x) %>%
filter(x>0.00) %>%
arrange(x) %>%
mutate(sample=as.numeric(isTip),
inter=table(parent)[as.character(node)],
dd=as.numeric(inter==1&!is.na(inter)),
coal=as.numeric(inter==2&!is.na(inter)))
read.tree(text=text) %>%
fortify(ladderize=TRUE) %>%
select(parent,node,isTip,x) %>%
filter(x>0.00) %>%
arrange(x) %>%
mutate(sample=as.numeric(isTip),
inter=table(parent)[as.character(node)],
dd=as.numeric(inter==1&!is.na(inter)),
coal=as.numeric(inter==2&!is.na(inter)),
lineages=1+cumsum(coal)-cumsum(sample))
read.tree(text=text) %>%
fortify(ladderize=TRUE) %>%
select(parent,node,isTip,x) %>%
filter(x>0.00) %>%
arrange(x) %>%
mutate(sample=as.numeric(isTip),
inter=table(parent)[as.character(node)],
dd=as.numeric(inter==1&!is.na(inter)),
coal=as.numeric(inter==2&!is.na(inter)),
lineages=1+cumsum(coal)-cumsum(sample)) %>%
transmute(time=x,lineages=lineages)
read.tree(text=text) %>%
fortify(ladderize=TRUE) %>%
select(parent,node,isTip,x) %>%
filter(x>0.00) %>%
arrange(x) %>%
mutate(sample=as.numeric(isTip),
inter=table(parent)[as.character(node)],
dd=as.numeric(inter==1&!is.na(inter)),
coal=as.numeric(inter==2&!is.na(inter)),
lineages=1+cumsum(coal)-cumsum(sample)) %>%
transmute(time=x,lineages=lineages,dd=dd,coal=coal,sample=sample)
install.packages("phylopomp_0.0.2.0.tar.gz",repos=NULL,type="source")
library(phylopomp)
playSIRwS(beta=2,gamma=1,psi=2,S0=100,I0=2,times=5,t0=0,tree=TRUE) -> x
y <- getInfo(x)
newick2df(y$tree) -> z
head(z)
detach("package:phylopomp", unload = TRUE)
install.packages("phylopomp_0.0.2.0.tar.gz",repos=NULL,type="source")
library(phylopomp)
devtools::document()
setwd("Rpkg/")
devtools::document()
devtools::document()
setwd("..")
install.packages("phylopomp_0.0.2.0.tar.gz",repos=NULL,type="source")
library(phylopomp)
playSIRwS(beta=2,gamma=1,psi=2,S0=100,I0=2,times=5,t0=0,tree=TRUE) -> x
y <- getInfo(x)
newick2df(y$tree) -> z
text <- gsub("\\w+|\\W+","",gsub("\\d+:",":",y$tree))
read.tree(text=text) %>%
fortify(ladderize=TRUE)
test
text
y$tree
gsub("\\w+|\\W+","",gsub("\\d+:",":",y$tree))
text <- y$tree
read.tree(text=text) %>% plot
playSIRwS(beta=2,gamma=1,psi=2,S0=1000,I0=2,times=5,t0=0,tree=TRUE) -> x
y <- getInfo(x)
newick2df(y$tree) -> z
y
y$tree
gsub("\\w+|\\W+","",gsub("\\d+:",":",y$tree))
tree <- y$tree
gsub("\\[a-z]+|\\[A-Z]+","",gsub("\\d+:",":",tree))
gsub("\\[a-z]+|\\[A-Z]+","",
gsub("\\d+:",":",gsub("\\w+:0.0,","",tree)))
gsub("\\w+:0.0,","",tree)
gsub("\\d+:",":",gsub("\\w+:0.0,","",tree))
gsub("([a-z]+)|([A-Z]+)","",
gsub("\\d+:",":",gsub("\\w+:0.0,","",tree)))
gsub("([a-z]+)|([A-Z]+)","",
gsub("\\d+:",":",tree))
text <- gsub("([a-z]+)|([A-Z]+)","",
gsub("\\d+:",":",tree))
read.tree(text=text) %>%
fortify(ladderize=TRUE) %>%
arrange(x) %>%
mutate(sample=as.numeric(isTip),
inter=table(parent)[as.character(node)],
dd=as.numeric(inter==1&!is.na(inter)),
coal=as.numeric(inter==2&!is.na(inter)),
lineages=1+cumsum(coal)-cumsum(sample)) %>%
transmute(time=x,lineages=lineages,dd=dd,coal=coal,sample=sample)
getwd()
setwd("Rpkg/")
devtools::document()
install.packages("../phylopomp_0.0.2.0.tar.gz",repos=NULL,type="source")
getwd()
library(phylopomp)
library(phylopomp)
playSIRwS(beta=2,gamma=1,psi=2,S0=100,I0=2,times=5,t0=0,tree=TRUE) -> x
y <- getInfo(x)
newick2df(y$tree) -> z
head(z)
getwd()
devtools::document()
install.packages("../phylopomp_0.0.2.0.tar.gz")
install.packages("../phylopomp_0.0.2.0.tar.gz",repos=NULL,type="source")
library(phylopomp)
playSIRwS(beta=2,gamma=1,psi=2,S0=100,I0=2,times=5,t0=0,tree=TRUE) -> x
y <- getInfo(x)
newick2df(y$tree) -> z
head(z)
read.tree(text=y$tree) %>% plot
library(ape)
read.tree(text=y$tree) %>% plot
z
read.tree(text=gsub("i:0.0,","",y$tree)) %>% plot
tree <- y$tree
gsub("([a-z]+)|([A-Z]+)|(:0.0,)","",
gsub("\\d+:",":",tree))
text <- gsub("([a-z]+)|([A-Z]+)|(:0.0,)","",
gsub("\\d+:",":",tree))
plot(u)
plot(y)
plot(y,points=TRUE)
read.tree(text=text) %>%
fortify(ladderize=TRUE)
library(ggplot2)
library(dplyr)
read.tree(text=text) %>%
fortify(ladderize=TRUE)
read.tree(text=text) %>%
fortify(ladderize=TRUE) %>%
arrange(x)
read.tree(text=text) %>%
fortify(ladderize=TRUE) %>%
arrange(x) %>%
mutate(sample=as.numeric(isTip),
inter=table(parent)[as.character(node)],
dd=as.numeric(inter==1&!is.na(inter)),
coal=as.numeric(inter==2&!is.na(inter)),
lineages=1+cumsum(coal)-cumsum(sample))
read.tree(text=text) %>%
fortify(ladderize=TRUE) %>%
arrange(x) %>%
mutate(sample=as.numeric(isTip),
inter=table(parent)[as.character(node)],
dd=as.numeric(inter==1&!is.na(inter)),
coal=as.numeric(inter==2&!is.na(inter)),
lineages=1+cumsum(coal)-cumsum(sample)) %>%
transmute(time=x,lineages=lineages,dd=dd,coal=coal,sample=sample)
getInfo(y) -> aa
View(aa)
aa$lineages
text <- gsub("([a-z]+)|([A-Z]+)","",
gsub("\\d+:",":",tree))
read.tree(text=text) %>%
fortify(ladderize=TRUE) %>%
arrange(x) %>%
mutate(sample=as.numeric(isTip),
inter=table(parent)[as.character(node)],
dd=as.numeric(inter==1&!is.na(inter)),
coal=as.numeric(inter==2&!is.na(inter)),
lineages=1+cumsum(coal)-cumsum(sample)) %>%
transmute(time=x,lineages=lineages,dd=dd,coal=coal,sample=sample)
read.tree(text=text) %>%
fortify(ladderize=TRUE) %>%
arrange(x)
text
read.tree(text=text) %>%
fortify(ladderize=TRUE) %>%
arrange(x) %>%
mutate(sample=as.numeric(isTip),
inter=table(parent)[as.character(node)]
)
read.tree(text=text) %>%
fortify(ladderize=TRUE) %>%
arrange(x) %>%
mutate(sample=as.numeric(isTip),
inter=table(parent)[as.character(node)]
)
text <- gsub("([a-z]+)|([A-Z]+)|(:0.0,)","",
gsub("\\d+:",":",tree))
read.tree(text=text) %>%
fortify(ladderize=TRUE) %>%
arrange(x) %>%
mutate(sample=as.numeric(isTip),
inter=table(parent)[as.character(node)],
dd=as.numeric(inter==1&!is.na(inter))
)
read.tree(text=text) %>%
fortify(ladderize=TRUE) %>%
arrange(x) %>%
mutate(sample=as.numeric(isTip),
inter=table(parent)[as.character(node)],
dd=as.numeric(inter==1&!is.na(inter)),
coal=as.numeric(inter>=2&!is.na(inter)),
lineages=1+cumsum(coal)-cumsum(sample)) %>%
transmute(time=x,lineages=lineages,dd=dd,coal=coal,sample=sample)
getwd()
devtools::document()
install.packages("../phylopomp_0.0.2.0.tar.gz",repos=NULL,type="source")
library(phylopomp)
playSIRwS(beta=2,gamma=1,psi=2,S0=100,I0=2,times=5,t0=0,tree=TRUE) -> x
y <- getInfo(x)
newick2df(y$tree) -> z
z
playSIRwS(beta=2,gamma=1,psi=2,S0=100,I0=5,times=5,t0=0,tree=TRUE) -> x
y <- getInfo(x)
newick2df(y$tree) -> z
z
View(z)
read.tree(text=gsub("i:0.0,","",y$tree)) %>% plot
library(ape)
read.tree(text=gsub("i:0.0,","",y$tree)) %>% plot
gsub("i:0.0,","",y$tree
)
playSIRwS(beta=2,gamma=1,psi=2,S0=100,I0=5,times=5,t0=0,tree=TRUE) -> x
y <- getInfo(x)
library(ape)
read.tree(text=gsub("i:0.0,","",y$tree)) %>% plot
newick2df(y$tree) -> z
z
y$lineages
aa <- y$lineages
View(aa)
##' Tree in newick to dataframe
##'
##' Covert a tree in newick to a data frame, containing event times, number of lineages, sample indicator, direct descent indicator, and coalescent indicator.
##'
##' @include package.R
##'
##' @param tree tree data in newick format.
##'
##' @return A data frame could be used as \code{pomp} input.
##'
##' @example examples/newick2df.R
##'
##' @importFrom ape read.tree
##' @importFrom ggplot2 fortify
##' @importFrom dplyr mutate arrange transmute
##'
##' @name newick2df
##' @rdname newick2df
##' @export
##'
newick2df <- function(tree) {
if(is.null(tree))
stop(sQuote("tree")," contains no variable ",call.=FALSE)
text <- gsub("([a-z]+)|([A-Z]+)","",
gsub("\\d+:",":",tree))
read.tree(text=text) %>%
fortify(ladderize=TRUE) %>%
arrange(x) %>%
mutate(sample=as.numeric(isTip),
inter=table(parent)[as.character(node)],
dd=as.numeric(inter==1&!is.na(inter)),
coal=as.numeric(inter>=2&!is.na(inter)),
lineages=1+cumsum(coal)-cumsum(sample)) %>%
transmute(time=x,lineages=lineages,dd=dd,coal=coal,sample=sample) -> df
df
}
newick2df(y$tree) -> z
playSIRwS(beta=2,gamma=1,psi=2,S0=100,I0=5,times=5,t0=0,tree=TRUE) -> x
y <- getInfo(x)
library(ape)
library(ggplot2)
library(dplyr)
read.tree(text=gsub("i:0.0,","",y$tree)) %>% plot
newick2df(y$tree) -> z
z
View(aa)
y$tree
playSIRwS(beta=2,gamma=1,psi=2,S0=100,I0=5,times=5,t0=0,tree=TRUE) -> x
y <- getInfo(x)
aa <- y$lineages
library(ape)
library(ggplot2)
library(dplyr)
read.tree(text=gsub("i:0.0,","",y$tree)) %>% plot
newick2df(y$tree) -> z
z
set.seed(192857230L)
playSIRwS(beta=2,gamma=1,psi=2,S0=100,I0=5,times=5,t0=0,tree=TRUE) -> x
y <- getInfo(x)
aa <- y$lineages
library(ape)
library(ggplot2)
library(dplyr)
read.tree(text=gsub("i:0.0,","",y$tree)) %>% plot
newick2df(y$tree) -> z
z
View(aa)
##' Tree in newick to dataframe
##'
##' Covert a tree in newick to a data frame, containing event times, number of lineages, sample indicator, direct descent indicator, and coalescent indicator.
##'
##' @include package.R
##'
##' @param tree tree data in newick format.
##'
##' @return A data frame could be used as \code{pomp} input.
##'
##' @example examples/newick2df.R
##'
##' @importFrom ape read.tree
##' @importFrom ggplot2 fortify
##' @importFrom dplyr mutate arrange transmute
##'
##' @name newick2df
##' @rdname newick2df
##' @export
##'
newick2df <- function(tree) {
if(is.null(tree))
stop(sQuote("tree")," contains no variable ",call.=FALSE)
text <- gsub("([a-z]+)|([A-Z]+)","",
gsub("\\d+:",":",tree))
read.tree(text=text) %>%
fortify(ladderize=TRUE) %>%
arrange(x) %>%
mutate(sample=as.numeric(isTip),
inter=table(parent)[as.character(node)],
dd=as.numeric(inter==1&!is.na(inter)),
coal=as.numeric(inter>=2&!is.na(inter)),
lineages=length(time==0.00)+cumsum(coal)-cumsum(sample)) %>%
transmute(time=x,lineages=lineages,dd=dd,coal=coal,sample=sample) -> df
df
}
newick2df(y$tree) -> z
z
newick2df <- function(tree) {
if(is.null(tree))
stop(sQuote("tree")," contains no variable ",call.=FALSE)
text <- gsub("([a-z]+)|([A-Z]+)","",
gsub("\\d+:",":",tree))
read.tree(text=text) %>%
fortify(ladderize=TRUE) %>%
arrange(x) %>%
mutate(sample=as.numeric(isTip),
inter=table(parent)[as.character(node)],
dd=as.numeric(inter==1&!is.na(inter)),
coal=as.numeric(inter>=2&!is.na(inter)),
lineages=sum(x==0.00)+cumsum(coal)-cumsum(sample)) %>%
transmute(time=x,lineages=lineages,dd=dd,coal=coal,sample=sample) -> df
df
}
newick2df(y$tree) -> z
a
z
View(aa)
tree <- y$tree
gsub("([a-z]+)|([A-Z]+)","",
gsub("\\d+:",":",tree))
text <- gsub("([a-z]+)|([A-Z]+)","",
gsub("\\d+:",":",tree))
text <- tree
read.tree(text=text) %>%
fortify(ladderize=TRUE) %>%
arrange(x) %>%
mutate(sample=as.numeric(isTip),
inter=table(parent)[as.character(node)],
dd=as.numeric(inter==1&!is.na(inter)),
coal=as.numeric(inter>=2&!is.na(inter)),
lineages=sum(x==0.00)+cumsum(coal)-cumsum(sample)) %>%
transmute(time=x,lineages=lineages,dd=dd,coal=coal,sample=sample)
read.tree(text=tree) %>%
fortify(ladderize=TRUE) %>%
arrange(x)
read.tree(text=tree) %>%
fortify(ladderize=TRUE) %>%
arrange(x) -> tt
tt %>% mutate(sample=as.numeric(isTip))
tt %>% select(x,parent,node,isTip)
tt %>% select(x,parent,node,isTip) -> tt
View(tt)
tt %>% mutate(sample=as.numeric(isTip))
tt %>% mutate(sample=as.numeric(isTip & x!=0.0))
tt %>% mutate(sample=as.numeric(isTip & x!=0.0)) -> tt
tt %>% mutate(inter=table(parent)[as.character(node)])
read.tree(text=tree) %>% plot
plot(tree)
plot(y)
plot(y, points=TRUE)
tt %>% mutate(inter=table(parent)[as.character(node)] %>% replace_na)
tt %>% mutate(inter=table(parent)[as.character(node)] %>% replace_na(0))
library(tidyverse)
tt %>% mutate(inter=table(parent)[as.character(node)] %>% replace_na(0))
read.tree(text=tree) %>%
fortify(ladderize=TRUE) %>%
arrange(x) %>%
mutate(sample=as.numeric(isTip & x!= 0.0),
inter=table(parent)[as.character(node)] %>% replace_na(0),
dd=as.numeric(inter==1),
coal=as.numeric(inter>=2),
lineages=sum(x==0.00)+cumsum(coal)-cumsum(sample)) %>%
transmute(time=x,lineages=lineages,dd=dd,coal=coal,sample=sample)
read.tree(text=tree) %>%
fortify(ladderize=TRUE) %>%
arrange(x) %>%
mutate(sample=as.numeric(isTip & x!= 0.0),
inter=table(parent)[as.character(node)] %>% replace_na(0),
dd=as.numeric(inter==1),
coal=as.numeric(inter==2),
lineages=sum(x==0.00)+cumsum(coal)-cumsum(sample))
read.tree(text=tree) %>%
fortify(ladderize=TRUE) %>%
arrange(x) %>%
mutate(sample=as.numeric(isTip & x!= 0.0),
inter=table(parent)[as.character(node)] %>% replace_na(0),
dd=as.numeric(inter==1),
coal=as.numeric(inter==2),
lineages=sum(x==0.00)+cumsum(coal)-cumsum(sample)) %>%
transmute(time=x,lineages=lineages,dd=dd,coal=coal,sample=sample)
View(aa)
getwd()
devtools::document()
